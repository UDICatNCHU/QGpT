# QGpT 使用指南

## 🎯 概述

QGpT (Question Generation from Partial Tables) 是一個改善表格檢索的框架，通過從部分表格生成合成問題來提升開放域表格檢索的效果。

## 📁 檔案結構

```
/Users/yaochungfan/QGpT/
├── corpus_embedding_builder.py # 語料庫嵌入向量建立器
├── qgpt_search.py            # 命令行搜索介面
├── example_retrieval.py      # 示例檢索腳本
├── qgpt_*.db                # QGpT 向量資料庫檔案
├── requirements.txt         # 依賴套件清單
├── CODE_README.md          # 程式碼說明
└── 使用指南.md              # 本檔案
```

## 🚀 快速開始

### 1. 安裝依賴

```bash
pip install -r requirements.txt
```

### 2. 生成表格嵌入

```bash
python corpus_embedding_builder.py
```

### 3. 搜索表格

#### 命令行搜索
```bash
# 基本搜索
python qgpt_search.py "財務報表"

# 指定結果數量和格式
python qgpt_search.py "construction project" -n 10 -f json

# 簡單格式輸出
python qgpt_search.py "學生成績" -f simple
```



#### 運行示例
```bash
python example_retrieval.py
```

## 📊 支援的搜索類型

- **中文查詢**: "財務報表", "建築工程", "學生成績"
- **英文查詢**: "financial statements", "construction project", "student information"
- **混合查詢**: 支援中英文混合的查詢

## 🎛️ 命令行選項

### qgpt_search.py 選項

- `query`: 搜索查詢字符串 (必須)
- `-n, --limit`: 返回結果數量 (預設: 5)
- `-f, --format`: 輸出格式
  - `detailed`: 詳細格式 (預設)
  - `simple`: 簡單格式
  - `json`: JSON 格式
- `--db`: 資料庫路徑 (自動偵測 qgpt_*.db 檔案)
- `--collection`: 集合名稱 (自動從資料庫名稱推導)

### 使用範例

```bash
# 詳細格式搜索
python qgpt_search.py "銀行利率"

# 簡單格式，限制 3 個結果
python qgpt_search.py "bank interest" -n 3 -f simple

# JSON 格式輸出
python qgpt_search.py "教育資源" -f json

# 查看幫助
python qgpt_search.py --help
```

## 🔧 系統架構

1. **資料載入**: 從 Corpora 目錄載入表格 JSON 資料
2. **文字預處理**: 清理和格式化表格文字
3. **嵌入生成**: 使用預訓練模型生成 768 維向量
4. **向量儲存**: 使用 Milvus 建立向量索引
5. **語義搜索**: 基於向量相似度進行檢索

## 📈 效能指標

- **資料量**: 295 個表格文件
- **向量維度**: 768 維
- **搜索速度**: 毫秒級響應
- **相似度範圍**: 0.0 - 1.0 (越高越相似)

## 🛠️ 故障排除

### 常見問題

1. **找不到集合錯誤**
   ```
   錯誤：找不到集合 'qgpt_table_embeddings'
   ```
   解決方案: 先執行 `python corpus_embedding_builder.py` 建立資料庫

2. **編碼錯誤**
   確保終端支援 UTF-8 編碼，特別是在 Windows 系統上

3. **記憶體不足**
   處理大量資料時可能需要更多記憶體，考慮分批處理

### 依賴問題

如果遇到套件相關問題，請確保：
- Python 版本 >= 3.8
- 已安裝所有必要依賴：`pip install -r requirements.txt`

## 📝 相關論文

如果您使用了這個系統，請引用我們的論文：

```bibtex
@inproceedings{
liang2025improving,
title={Improving Table Retrieval with Question Generation from Partial Tables},
author={Hsing-Ping Liang and Che-Wei Chang and Yao-Chung Fan},
booktitle={The 4th Table Representation Learning Workshop at ACL 2025},
year={2025},
url={https://openreview.net/forum?id=Q8HOV0UMwA}
}
```

## 📧 聯絡方式

如有問題或建議，請聯絡：cc3374twa@gmail.com

## 🔄 更新日誌

- **2025/09/09**: 重構程式碼，改善命名規範和文件結構
- **2025/09/08**: 發布 Hugging Face 資料集
- **初始版本**: 實現基本的表格檢索功能
